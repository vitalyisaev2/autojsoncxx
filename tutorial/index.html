<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">

        <title>Tutorial - autojsoncxx</title>

        <link href="../css/bootstrap-3.0.3.min.css" rel="stylesheet">
        <link href="../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link href="../css/prettify-1.0.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" href="..">autojsoncxx</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            
            
                <li class="active">
                    <a href="./">Tutorial</a>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">User guide <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../user_guide/definition_file_syntax/">Definition file syntax</a>
                        </li>
                    
                        <li >
                            <a href="../user_guide/error_handling/">Error handling</a>
                        </li>
                    
                        <li >
                            <a href="../user_guide/miscellaneous/">Miscellaneous</a>
                        </li>
                    
                        <li >
                            <a href="../user_guide/type_support/">Type support</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                
                <li >
                    <a rel="next" href="..">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="../user_guide/definition_file_syntax/">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
                <li>
                    <a href="https://github.com/netheril96/autojsoncxx">
                        
                            <i class="fa fa-github"></i>
                        
                        GitHub
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#tutorial">Tutorial</a></li>
        
            <li><a href="#code-generation">Code generation</a></li>
        
            <li><a href="#serialization">Serialization</a></li>
        
            <li><a href="#parsing">Parsing</a></li>
        
            <li><a href="#error-handling">Error handling</a></li>
        
            <li><a href="#more-complex-types">More complex types</a></li>
        
            <li><a href="#dom-support">DOM support</a></li>
        
    
    </ul>
</div></div>
            <div class="col-md-9" role="main">

<h1 id="tutorial">Tutorial</h1>
<h2 id="code-generation">Code generation</h2>
<p>The code generator reads a JSON file that defines the class structure. An example definition is like this (remember to fully qualify the type name with its namespace)</p>
<pre class="prettyprint well"><code class="javascript">{
    &quot;name&quot;: &quot;Person&quot;,
    &quot;members&quot;:
    [
        [&quot;unsigned long long&quot;, &quot;ID&quot;, {&quot;required&quot;: true}],
        [&quot;std::string&quot;, &quot;name&quot;, {&quot;default&quot;: &quot;anonymous&quot;}],
        [&quot;double&quot;, &quot;height&quot;],
        [&quot;double&quot;, &quot;weight&quot;],
        [&quot;std::vector&lt;unsigned long long&gt;&quot;, &quot;known_associates&quot;]
    ]
}
</code></pre>

<p>Run the script <em>autojsoncxx.py</em> (requires Python 2.7+, including version 3+) on this definition file, and a header file will be generated. It includes a definition for <code>Person</code> as well as some helper classes. The <code>Person</code> is a <code>struct</code> with all members public, meant as a data holder without any additional functionalities. It can be used with free functions, or <a href="https://en.wikipedia.org/wiki/Composition_over_inheritance">wrapped up in another class to provide encapsulation and polymorphism</a>.</p>
<pre class="prettyprint well"><code class="bash">python autojsoncxx.py --input=persondef.json --output=person.hpp
</code></pre>

<p>Remember to add the include directory of <em>autojsoncxx</em> and <em>rapidjson</em> to your project header search path (no linking is required).</p>
<p>The below examples uses c++11 features, but the library also works with c++03 compilers (provided you do not use new classes from c++11).</p>
<h2 id="serialization">Serialization</h2>
<pre class="prettyprint well"><code class="c++">#define AUTOJSONCXX_MODERN_COMPILER 1 // Turn on all the c++11 features of the library
#include &lt;iostream&gt;
#include &quot;person.hpp&quot;

int main()
{
    Person p;
    p.name = &quot;Mike&quot;;
    p.ID = 8940220481904ULL;
    p.weight = 70;
    p.height = 1.77;
    p.known_associates = { 149977889346362, 90000134866608, 44412567664 };
    // Use successive push_back() if your compiler is not c++11 ready

    autojsoncxx::to_pretty_json_file(&quot;person.json&quot;, p);
    return 0;
}
</code></pre>

<p>This will generate a file <code>person.json</code> with contents below:</p>
<pre class="prettyprint well"><code class="javascript">{
    &quot;name&quot;: &quot;Mike&quot;,
    &quot;ID&quot;: 8940220481904,
    &quot;height&quot;: 1.77,
    &quot;weight&quot;: 70.0,
    &quot;known_associates&quot;: [
        149977889346362,
        90000134866608,
        44412567664
    ]
}
</code></pre>

<h2 id="parsing">Parsing</h2>
<p>Now let's try read that back</p>
<pre class="prettyprint well"><code class="c++">#define AUTOJSONCXX_MODERN_COMPILER 1
#include &lt;iostream&gt;
#include &quot;person.hpp&quot;

int main()
{
    autojsoncxx::ParsingResult result;
    Person p;
    if (!autojsoncxx::from_json_file(&quot;person.json&quot;, p, result)) {
        std::cerr &lt;&lt; result &lt;&lt; '\n';
        return -1;
    }

    std::cout &lt;&lt; &quot;ID: &quot; &lt;&lt; p.ID &lt;&lt; '\n'
              &lt;&lt; &quot;name:  &quot; &lt;&lt; p.name &lt;&lt; '\n'
              &lt;&lt; &quot;height: &quot; &lt;&lt; p.height &lt;&lt; '\n'
              &lt;&lt; &quot;weight: &quot; &lt;&lt; p.weight &lt;&lt; '\n';

    std::cout &lt;&lt; &quot;known associates: &quot;;
    for (auto&amp;&amp; id : p.known_associates)
        std::cout &lt;&lt; id &lt;&lt; '\t';
    std::cout &lt;&lt; '\n';
    return 0;
}
</code></pre>

<h2 id="error-handling">Error handling</h2>
<p>Any decent JSON library can detect and report errors resulting from a invalid JSON. In addition, <em>autojsoncxx</em> will detect and stop processing once the JSON value does not match the C++ type specification. This enforces the static typing of C++ on the dynamic JSON, and can be seen as a limited form of JSON schema.</p>
<p>Here is valid JSON file</p>
<pre class="prettyprint well"><code class="javascript">{
    &quot;name&quot;: &quot;Mike&quot;,
    &quot;ID&quot;: 8940220481904,
    &quot;height&quot;: 1.77,
    &quot;weight&quot;: 70.0,
    &quot;known_associates&quot;: [
        &quot;Jack&quot;, &quot;Mary&quot;
    ]
}
</code></pre>

<p>Running through the parsing code, and you will get an error output:</p>
<pre class="prettyprint well"><code>Parsing failed at offset 127 with error code 16:
Terminate parsing due to Handler error.

Trace back (last call first):
(*) Type mismatch between expected type &quot;uint64_t&quot; and actual type &quot;string&quot;
(*) Error at array element with index 0
(*) Error at object member with name &quot;known_associates&quot;
</code></pre>

<p>You can also <a href="../user_guide/error_handling/">programmingly examine the error</a>.</p>
<h2 id="more-complex-types">More complex types</h2>
<p>The design of <code>autojsoncxx</code> makes it possible to read/write not only the class generated, but also the combination of all supported types. That is, you can also call the <code>to_json</code> and <code>from_json</code> family of functions on <code>std::vector&lt;Person&gt;</code>, <code>std::map&lt;std::string, Person&gt;</code>, <code>std::shared_ptr&lt;Person&gt;</code>, or even more complicated ones like <code>std::tuple&lt;std::string, double, Person, std::deque&lt;int&gt;, std::vector&lt;std::unique_ptr&lt;Person&gt;&gt;, bool&gt;</code>.</p>
<p>This also makes it possible to build more complex types. For example, the definition file can be written as</p>
<pre class="prettyprint well"><code class="javascript">[
    {
        &quot;name&quot;: &quot;Person&quot;,
        &quot;members&quot;:
        [
            [&quot;unsigned long long&quot;, &quot;ID&quot;, {&quot;required&quot;: true}],
            [&quot;std::string&quot;, &quot;name&quot;, {&quot;default&quot;: &quot;anonymous&quot;}],
            [&quot;double&quot;, &quot;height&quot;],
            [&quot;double&quot;, &quot;weight&quot;],
            [&quot;std::vector&lt;unsigned long long&gt;&quot;, &quot;known_associates&quot;]
        ]
    },
    {
        &quot;name&quot;: &quot;Group&quot;,
        &quot;members&quot;:
        [
            [&quot;unsigned long long&quot;, &quot;GroupID&quot;, {&quot;required&quot;: true}],
            [&quot;std::string&quot;, &quot;name&quot;],
            [&quot;std::vector&lt;std::shared_ptr&lt;Person&gt;&gt;&quot;, &quot;persons&quot;]
        ]
    }
]
</code></pre>

<p>So you have another struct that contains <code>Person</code> as a member.</p>
<h2 id="dom-support">DOM support</h2>
<p><em>autojsoncxx</em> is based on streams, which is efficient both in time and space. However, maybe sometimes Document Object Model is desired. One can convert types supported by <em>autojsoncxx</em> to/from <code>rapidjson::Document</code> directly through free functions <code>to_document</code> and <code>from_document</code>.</p>
<p>In addition, <code>rapidjson::Document</code> is supported the same as <code>int</code> or <code>std::map</code>, so it can be the type of class members. This makes it possible to intermix static typing and dynamic typing.</p>
</div>
        </div>

        

        <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
        <script src="../js/bootstrap-3.0.3.min.js"></script>
        <script src="../js/prettify-1.0.min.js"></script>
        <script src="../js/base.js"></script>
    </body>
</html>